___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Outbrain Server-to-Server",
  "brand": {
    "id": "github.com_stape-io",
    "displayName": "owntag",
    "thumbnail": "data:image/png;base64,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"
  },
  "description": "A tag to run Outbrain Server-to-Server (S2S) tracking",
  "containerContexts": [
    "SERVER"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "LABEL",
    "name": "clickIdNotice",
    "displayName": "To enable Outbrain server-to-server tracking, you will need to append a click ID parameter to your campaigns\u0027 target URLs.\n\u003cbr/\u003e\nRead the \u003ca href\u003d\"https://www.outbrain.com/help/advertisers/server2server-integrations/\" target\u003d\"_blank\"\u003eOutbrain documentation\u003c/a\u003e for more details.\n\u003cbr/\u003e\u003cbr/\u003e"
  },
  {
    "type": "RADIO",
    "name": "tagType",
    "displayName": "Event Type",
    "radioItems": [
      {
        "value": "page_view",
        "displayValue": "Page view (sets cookie with Outbrain Click ID)"
      },
      {
        "value": "conversion",
        "displayValue": "Conversion"
      }
    ],
    "simpleValueType": true,
    "defaultValue": "page_view"
  },
  {
    "type": "GROUP",
    "name": "clickIdParameter",
    "displayName": "Click ID",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "RADIO",
        "name": "clickIdParameterExtractionMethod",
        "displayName": "How would you like to read the Outbrain Click ID?",
        "radioItems": [
          {
            "value": "url",
            "displayValue": "Automatically read click ID from page_location, i. e. the user\u0027s URL (recommended)"
          },
          {
            "value": "manual",
            "displayValue": "Provide click ID manually"
          }
        ],
        "simpleValueType": true
      },
      {
        "type": "TEXT",
        "name": "clickIdParameterName",
        "displayName": "URL parameter name for Outbrain Click ID",
        "simpleValueType": true,
        "help": "Make sure you add the Outbrain click ID to the target URLs of your Outbrain campaigns! Read the \u003ca href\u003d\"https://www.outbrain.com/help/advertisers/server2server-integrations/\" target\u003d\"_blank\"\u003eOutbrain documentation\u003c/a\u003e for more details.",
        "defaultValue": "obclid",
        "enablingConditions": [
          {
            "paramName": "clickIdParameterExtractionMethod",
            "paramValue": "url",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "clickIdParameterManualValue",
        "displayName": "Outbrain Click ID",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "clickIdParameterExtractionMethod",
            "paramValue": "manual",
            "type": "EQUALS"
          }
        ]
      }
    ],
    "enablingConditions": [
      {
        "paramName": "tagType",
        "paramValue": "page_view",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "conversionGroup",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "TEXT",
        "name": "eventName",
        "displayName": "Event Name",
        "simpleValueType": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "help": "Event names are case-sensitive."
      },
      {
        "type": "CHECKBOX",
        "name": "provideOrderData",
        "checkboxText": "Provide order data",
        "simpleValueType": true,
        "defaultValue": false
      },
      {
        "type": "GROUP",
        "name": "orderData",
        "displayName": "Order Data",
        "groupStyle": "NO_ZIPPY",
        "subParams": [
          {
            "type": "SELECT",
            "name": "orderId",
            "displayName": "Order ID",
            "macrosInSelect": true,
            "selectItems": [],
            "simpleValueType": true
          },
          {
            "type": "SELECT",
            "name": "orderValue",
            "displayName": "Order Value",
            "macrosInSelect": true,
            "selectItems": [],
            "simpleValueType": true
          },
          {
            "type": "TEXT",
            "name": "currency",
            "displayName": "Order Currency",
            "simpleValueType": true
          }
        ],
        "enablingConditions": [
          {
            "paramName": "provideOrderData",
            "paramValue": true,
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "CHECKBOX",
        "name": "clickIdCustomization",
        "checkboxText": "Provide click ID manually",
        "simpleValueType": true
      },
      {
        "type": "TEXT",
        "name": "clickId",
        "displayName": "Outbrain click ID",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "clickIdCustomization",
            "paramValue": true,
            "type": "EQUALS"
          }
        ]
      }
    ],
    "enablingConditions": [
      {
        "paramName": "tagType",
        "paramValue": "conversion",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "CHECKBOX",
    "name": "customizeCookieSettings",
    "checkboxText": "Customize cookie settings",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "clickIdCustomization",
        "paramValue": false,
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "cookieCustomizationGroup",
    "displayName": "Cookie customization",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "TEXT",
        "name": "cookieExpirationInSeconds",
        "displayName": "Cookie lifetime in seconds",
        "simpleValueType": true,
        "defaultValue": 2592000,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          },
          {
            "type": "NON_NEGATIVE_NUMBER"
          }
        ],
        "enablingConditions": [
          {
            "paramName": "tagType",
            "paramValue": "page_view",
            "type": "EQUALS"
          }
        ],
        "help": "How long the click ID cookie should be allowed to persist in the user\u0027s browser in seconds.\nExample: 2592000 (\u003d 30 days)"
      },
      {
        "type": "TEXT",
        "name": "clickIdCookieName",
        "displayName": "Click ID cookie name",
        "simpleValueType": true,
        "defaultValue": "obclid",
        "help": "The name of the cookie that Outbrain\u0027s click ID will be stored from with the Page View tag and read from with the conversion tag."
      },
      {
        "type": "LABEL",
        "name": "clickIdCookieNamePermissionsNotice",
        "displayName": "Notice:\nYou have changed the cookie name from the default \"obclid\".\nPlease add your cookie name in the \"Permissions\" tab of this tag template in the sections\u003cbr/\u003e\n\u003ci\u003e\"Read cookie values\"\u003c/i\u003e and\u003cbr/\u003e\n\u003ci\u003e\"Sets a cookie\"\u003c/i\u003e\u003cbr/\u003e\nto allow access to the cookie.",
        "enablingConditions": [
          {
            "paramName": "clickIdCookieName",
            "paramValue": "obclid",
            "type": "NOT_EQUALS"
          }
        ]
      }
    ],
    "enablingConditions": [
      {
        "paramName": "customizeCookieSettings",
        "paramValue": true,
        "type": "EQUALS"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_SERVER___

// Require necessary functions from Google Tag Manager's server-side API.
const encodeUriComponent = require("encodeUriComponent");
const getCookieValues = require("getCookieValues");
const getEventData = require("getEventData");
const getRequestHeader = require("getRequestHeader");
const parseUrl = require("parseUrl");
const sendHttpRequest = require("sendHttpRequest");
const setCookie = require("setCookie");
const makeNumber = require("makeNumber");

// Defaults
const defaultClickIdCookieName = "obclid"; // Default name for the click ID cookie.

// Configurations 
const clickIdCookieName = data.clickIdCookieName || defaultClickIdCookieName;
const cookieExpirationInSeconds = makeNumber(data.cookieExpirationInSeconds);

// Check if the tag type is for a page view event.
if (data.tagType === "page_view") {
	// Attempt to get the current page URL from event data or the HTTP referer header.
	const url = getEventData("page_location") || getRequestHeader("referer");
	if (url) {
		// If a URL is found...
		// Extract the click ID value from the URL based on the provided parameter name.
		const clickId = parseUrl(url).searchParams[data.clickIdParameterName];
		if (clickId) {
			const cookieOptions = {
				domain: "auto", // Set cookie to eTLD+1
				path: "/", // The cookie is available for the whole domain.
				secure: true, // Cookie is sent only over HTTPS.
				httpOnly: false, // Cookie is accessible to client-side scripts.
			};

			if (cookieExpirationInSeconds > 0)
				cookieOptions["max-age"] = cookieExpirationInSeconds;

			// Set the cookie with the click ID value.
			setCookie(clickIdCookieName, clickId, cookieOptions, false);
		}
	}

	data.gtmOnSuccess();
}
// Conversion event tag type
else {
	// Retrieve the click ID from a cookie or use a default.
	const clickId = getCookieValues(clickIdCookieName)[0] || data.clickId || "";

	// Construct the request URL with parameters including the click ID and event details.
	let requestUrl = buildUrlWithParams(
		"https://tr.outbrain.com/unifiedPixel",
		{
			ob_click_id: clickId,
			name: data.eventName, // Event name (e.g., conversion event).
			orderId: data.orderId, // Order ID, if applicable.
			orderValue: data.orderValue, // Order value, if applicable.
			currency: data.currency, // Currency code, if applicable.
		}
	);

	// Send the HTTP request to the constructed URL.
	sendHttpRequest(
		requestUrl,
		(statusCode, headers, body) => {
			// Check if the response status code indicates success.
			if (statusCode >= 200 && statusCode < 300) {
				data.gtmOnSuccess();
			} else {
				data.gtmOnFailure();
			}
		},
		{ method: "GET" }
	);
}

/**
 * Constructs a URL with query parameters added from a given object.
 * Iterates over each key-value pair in the parameters object and appends
 * them as query parameters to the base URL. Only parameters with truthy
 * values are appended, ensuring unnecessary parameters are omitted. Each
 * parameter value is encoded for URL usage.
 *
 * @param {string} baseUrl The base URL to which query parameters will be appended.
 * @param {Object} params An object containing the query parameters as key-value pairs.
 *                        Only truthy values are appended to the URL.
 * @returns {string} The constructed URL with the provided query parameters appended.
 *
 * @example
 * // returns 'https://example.com?name=JohnDoe&age=30'
 * buildUrlWithParams('https://example.com', { name: 'JohnDoe', age: 30, emptyParam: '' });
 */
function buildUrlWithParams(baseUrl, params) {
	let queryParameters = [];
	for (let key in params) {
		if (params.hasOwnProperty(key) && params[key]) {
			let encodedKey = encodeUriComponent(key);
			let encodedValue = encodeUriComponent(params[key]);
			queryParameters.push(encodedKey + "=" + encodedValue);
		}
	}
	return (
		baseUrl +
		(queryParameters.length ? "?" + queryParameters.join("&") : "")
	);
}


___SERVER_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "read_event_data",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keyPatterns",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "page_location"
              }
            ]
          }
        },
        {
          "key": "eventDataAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_http",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://tr.outbrain.com/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "set_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedCookies",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "name"
                  },
                  {
                    "type": 1,
                    "string": "domain"
                  },
                  {
                    "type": 1,
                    "string": "path"
                  },
                  {
                    "type": 1,
                    "string": "secure"
                  },
                  {
                    "type": 1,
                    "string": "session"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "obclid"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_request",
        "versionId": "1"
      },
      "param": [
        {
          "key": "headerWhitelist",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "headerName"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "trace-id"
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "headerName"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "referer"
                  }
                ]
              }
            ]
          }
        },
        {
          "key": "headersAllowed",
          "value": {
            "type": 8,
            "boolean": true
          }
        },
        {
          "key": "requestAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "headerAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "queryParameterAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "cookieAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "cookieNames",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "obclid"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Page view tag
  code: |
    // Define mock data to simulate a page view event with specific conditions.
    const mockData = {
      tagType: "page_view", // Indicates the type of event to test, in this case, a page view.
      clickIdParameterName: "obclid", // The query parameter name from which the click ID should be extracted.
      cookieExpirationInSeconds: 2592000 // The duration for which the cookie should be valid.
    };

    // Mock 'getEventData' to simulate the retrieval of the page location, including the click ID in the URL.
    mock("getEventData", function(key) {
      // Return a sample URL that includes the click ID as a query parameter.
      if (key === "page_location") return "https://example.com?utm_source=outbrain&utm_medium=discovery&obclid=1234567890";
    });

    // Call runCode to execute the template's code with the provided mock data,
    // simulating the handling of a page view event.
    runCode(mockData);

    // Verify that a cookie is set correctly with the extracted click ID.
    // This checks that the 'setCookie' API was called with the expected arguments:
    // - "obclid" as the cookie name,
    // - "1234567890" as the cookie value (extracted from the URL),
    // - defaultCookieOptions containing the domain, path, secure, httpOnly, and max-age settings as defined in the template code,
    // - false for the 'respectConsent' parameter, indicating consent checks are not applicable in this context.
    assertApi('setCookie').wasCalledWith("obclid", "1234567890", defaultCookieOptions, false);

    // Confirm that the tag execution finished successfully,
    // indicating the page view event and click ID processing completed as expected.
    assertApi('gtmOnSuccess').wasCalled();
- name: Page view tag with different click ID parameter
  code: |
    // Define mock data to simulate a page view event with specific conditions.
    const mockData = {
      tagType: "page_view", // Indicates the type of event to test, in this case, a page view.
      clickIdParameterName: "OutbrainClickId", // The query parameter name from which the click ID should be extracted.
      cookieExpirationInSeconds: 2592000 // The duration for which the cookie should be valid.
    };

    // Mock 'getEventData' to simulate the retrieval of the page location, including the click ID in the URL.
    mock("getEventData", function(key) {
      // Return a sample URL that includes the click ID as a query parameter.
      if (key === "page_location") return "https://example.com?utm_source=outbrain&utm_medium=discovery&OutbrainClickId=1234567890";
    });

    // Call runCode to execute the template's code with the provided mock data,
    // simulating the handling of a page view event.
    runCode(mockData);

    // Verify that a cookie is set correctly with the extracted click ID.
    // This checks that the 'setCookie' API was called with the expected arguments:
    // - "obclid" as the cookie name,
    // - "1234567890" as the cookie value (extracted from the URL),
    // - defaultCookieOptions containing the domain, path, secure, httpOnly, and max-age settings as defined in the template code,
    // - false for the 'respectConsent' parameter, indicating consent checks are not applicable in this context.
    assertApi('setCookie').wasCalledWith("obclid", "1234567890", defaultCookieOptions, false);

    // Confirm that the tag execution finished successfully,
    // indicating the page view event and click ID processing completed as expected.
    assertApi('gtmOnSuccess').wasCalled();
- name: Page view tag with manually provided click ID
  code: |
    // Define mock data to simulate a page view event with specific conditions.
    const mockData = {
      tagType: "page_view", // Indicates the type of event to test, in this case, a page view.
      clickIdParameterName: "obclid", // The query parameter name from which the click ID should be extracted.
      cookieExpirationInSeconds: 2592000, // The duration for which the cookie should be valid.
      clickIdParameterExtractionMethod: "manual",
      clickIdParameterManualValue: "myManualClickId123"
    };

    // Mock 'getEventData' to simulate the retrieval of the page location, including the click ID in the URL.
    mock("getEventData", function(key) {
      // Return a sample URL that includes the click ID as a query parameter.
      if (key === "page_location") return "https://example.com?utm_source=outbrain&utm_medium=discovery&obclid=myManualClickId123";
    });

    // Call runCode to execute the template's code with the provided mock data,
    // simulating the handling of a page view event.
    runCode(mockData);

    // Verify that a cookie is set correctly with the extracted click ID.
    // This checks that the 'setCookie' API was called with the expected arguments:
    // - "obclid" as the cookie name,
    // - "1234567890" as the cookie value (extracted from the URL),
    // - defaultCookieOptions containing the domain, path, secure, httpOnly, and max-age settings as defined in the template code,
    // - false for the 'respectConsent' parameter, indicating consent checks are not applicable in this context.
    assertApi('setCookie').wasCalledWith("obclid", "myManualClickId123", defaultCookieOptions, false);

    // Confirm that the tag execution finished successfully,
    // indicating the page view event and click ID processing completed as expected.
    assertApi('gtmOnSuccess').wasCalled();
- name: Conversion tag (Purchase without order data)
  code: "// Define mock data to simulate a conversion event without order data.\n\
    const mockData = {\n  tagType: \"conversion\", // Type of the event being tested\
    \ (conversion in this case).\n  eventName: \"Purchase\", // Name of the event.\n\
    \  provideOrderData: false // Flag to indicate that no order data is provided\
    \ for this event.\n};\n\n// Mock 'getCookieValues' function to return a specific\
    \ click ID when queried.\nmock(\"getCookieValues\", function(key) {\n  if (key\
    \ === \"obclid\") return [\"1234567890\"]; // Simulates finding a click ID stored\
    \ in a cookie.\n});\n\n// Mock 'sendHttpRequest' to verify the URL and options\
    \ passed to it match expectations.\nmock(\"sendHttpRequest\", function(url, callback,\
    \ options) {\n  // Verify that the URL is constructed correctly with the click\
    \ ID and event name.\n  assertThat(url).isEqualTo(\"https://tr.outbrain.com/unifiedPixel?ob_click_id=1234567890&name=Purchase\"\
    );\n  // Ensure the HTTP method specified for the request is \"GET\".\n  assertThat(options).isEqualTo({\
    \ method: \"GET\" });\n  \n  // Simulate a successful response (HTTP status 200)\
    \ from the server.\n  callback(200);\n});\n\n// Call runCode to execute the template's\
    \ code with the provided mock data.\nrunCode(mockData);\n\n// Verify that the\
    \ 'sendHttpRequest' API was indeed called. This ensures our HTTP request logic\
    \ is executed.\nassertApi('sendHttpRequest').wasCalled();\n// Confirm that the\
    \ tag finishes successfully, indicating the conversion event was processed as\
    \ expected.\nassertApi('gtmOnSuccess').wasCalled();\n"
- name: Conversion tag (Purchase with order data)
  code: "const mockDataWithOrder = {\n  tagType: \"conversion\",\n  eventName: \"\
    Purchase\",\n  provideOrderData: true,\n  orderId: \"ORD123456\",\n  orderValue:\
    \ \"150.00\",\n  currency: \"USD\"\n};\n\nmock(\"getCookieValues\", function(key)\
    \ {\n  if (key === \"obclid\") return [\"1234567890\"];\n});\n\nmock(\"sendHttpRequest\"\
    , function(url, callback, options) {\n  assertThat(url).isEqualTo(\"https://tr.outbrain.com/unifiedPixel?ob_click_id=1234567890&name=Purchase&orderId=ORD123456&orderValue=150.00&currency=USD\"\
    );\n  assertThat(options).isEqualTo({ method: \"GET\" });\n  \n  callback(200);\
    \ // Simulate a successful HTTP response\n});\n\n// Call runCode to run the template's\
    \ code with the mock data including order details.\nrunCode(mockDataWithOrder);\n\
    \n// Verify that the sendHttpRequest API was called with the expected URL and\
    \ options.\nassertApi('sendHttpRequest').wasCalled();\n\n// Verify that the tag\
    \ finished successfully indicating that the conversion with order data was processed\
    \ correctly.\nassertApi('gtmOnSuccess').wasCalled();\n"
setup: "const defaultCookieOptions = {\n\tdomain: \"auto\",\n\tpath: \"/\",\n\tsecure:\
  \ true,\n\thttpOnly: false,\n    \"max-age\": 2592000\n};"


___NOTES___

Created on 10/11/2021, 09:29:27


